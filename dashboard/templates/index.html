{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- Left Sidebar - Channel List -->
    <div class="col-md-3">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <i class="bi bi-list-ul"></i> Canales
            </div>
            <div class="card-body">
                <div id="channels-loading" class="text-center">
                    <div class="spinner-border spinner-border-sm" role="status"></div>
                    <span class="ms-2">Cargando...</span>
                </div>
                <div id="channels-list" class="list-group" style="display:none;"></div>
            </div>
        </div>

        <!-- Bot Stats -->
        <div class="card mt-3">
            <div class="card-header bg-info text-white">
                <i class="bi bi-graph-up"></i> Estadísticas
            </div>
            <div class="card-body">
                <div id="bot-stats">
                    <p class="mb-2"><strong>Servidores:</strong> <span id="guild-count">-</span></p>
                    <p class="mb-2"><strong>Latencia:</strong> <span id="latency">-</span> ms</p>
                    <p class="mb-0"><strong>Usuario:</strong> <span id="bot-user">-</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content - Message Composer -->
    <div class="col-md-9">
        <!-- Tab Navigation -->
        <ul class="nav nav-tabs" id="composerTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="text-tab" data-bs-toggle="tab" data-bs-target="#text-composer" type="button">
                    <i class="bi bi-chat-text"></i> Mensaje de Texto
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="embed-tab" data-bs-toggle="tab" data-bs-target="#embed-composer" type="button">
                    <i class="bi bi-card-text"></i> Mensaje Embed
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content border border-top-0 p-4" id="composerTabsContent">
            <!-- Text Message Composer -->
            <div class="tab-pane fade show active" id="text-composer" role="tabpanel">
                <h5>Enviar Mensaje de Texto</h5>
                <form id="text-message-form">
                    <div class="mb-3">
                        <label for="text-channel-select" class="form-label">Canal de destino</label>
                        <select class="form-select" id="text-channel-select" required disabled>
                            <option value="">Selecciona un canal</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="text-content" class="form-label">Contenido del mensaje</label>
                        <textarea class="form-control" id="text-content" rows="6" required
                                  placeholder="Escribe tu mensaje aquí..."></textarea>
                        <div class="form-text">
                            Caracteres: <span id="char-count">0</span>/2000
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="send-text-btn" disabled>
                        <i class="bi bi-send"></i> Enviar Mensaje
                    </button>
                </form>
            </div>

            <!-- Embed Message Composer -->
            <div class="tab-pane fade" id="embed-composer" role="tabpanel">
                <h5>Crear Mensaje Embed</h5>
                <form id="embed-message-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="embed-channel-select" class="form-label">Canal de destino</label>
                                <select class="form-select" id="embed-channel-select" required disabled>
                                    <option value="">Selecciona un canal</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="embed-title" class="form-label">Título del Embed</label>
                                <input type="text" class="form-control" id="embed-title" required
                                       placeholder="Título principal" maxlength="256">
                            </div>

                            <div class="mb-3">
                                <label for="embed-description" class="form-label">Descripción</label>
                                <textarea class="form-control" id="embed-description" rows="4"
                                          placeholder="Descripción del embed" maxlength="4096"></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="embed-color" class="form-label">Color</label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" id="embed-color" value="#00e5a8">
                                    <input type="text" class="form-control" id="embed-color-hex" value="#00e5a8" placeholder="#00e5a8">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="embed-footer" class="form-label">Footer (opcional)</label>
                                <input type="text" class="form-control" id="embed-footer" placeholder="Texto del footer">
                            </div>

                            <div class="mb-3">
                                <label for="embed-image" class="form-label">URL de Imagen (opcional)</label>
                                <input type="url" class="form-control" id="embed-image" placeholder="https://example.com/image.png">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Vista Previa</label>
                                <div class="card" id="embed-preview">
                                    <div class="card-body">
                                        <div id="preview-content">
                                            <div class="border-start border-4 ps-3" style="border-color: #00e5a8 !important;">
                                                <h6 class="card-title" id="preview-title">Título del Embed</h6>
                                                <p class="card-text" id="preview-description">Descripción del embed aparecerá aquí...</p>
                                                <img id="preview-image" src="" class="img-fluid mt-2" style="display:none;">
                                                <small class="text-muted d-block mt-2" id="preview-footer"></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" id="send-embed-btn" disabled>
                        <i class="bi bi-send"></i> Enviar Embed
                    </button>
                </form>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="alert-container" class="mt-3"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/composer.js"></script>
{% endblock %}
